name: Reviewed deployment workflow

on:
  workflow_call:
    inputs:
      environment:
        required: true
        type: string

jobs:
  build:
    if: github.ref_name == 'master'
    permissions:
      contents: read
      packages: write
    uses: ./.github/workflows/reusable/build.yml
    with:
      environment: ${{ inputs.environment }}
    secrets: inherit
  review:
    needs: build
    uses: ./.github/workflows/reusable/review.yml
  deploy:
    needs: review
    uses: ./.github/workflows/reusable/deploy.yml
    with:
      environment: ${{ inputs.environment }}
    secrets: inherit
